# 런웨이 "6 뮤직비디오 장소" 오류 원인 분석

## 현상

- **조건**: 여자/남자 샘플 선택 후, **6 뮤직비디오 장소**만 선택하고 "런웨이 한 편 만들기" 클릭
- **오류**: `런웨이 배경 이미지를 불러올 수 없습니다.`
- **환경 차이**: 로컬 서버에서는 정상, **https://borahae.fan/** 운영 서버에서만 오류

---

## 핵심 원인 (한 줄)

**6 뮤직비디오 장소만 `33.jfif` 확장자를 사용하는데, Cloudflare Pages에서 `.jfif` 요청 시 500 Internal Server Error가 반환됩니다.**

---

## 상세 분석

### 1) 배경 이미지 구성

| 배경 | list.json image | 실제 파일 | 운영 서버 응답 |
|------|-----------------|-----------|----------------|
| 1~5 뮤직비디오 장소 | 1.jpeg, 2.jpeg, 3.jpeg, 11.jpeg, 22.jpeg | .jpeg | ✅ 정상 |
| **6 뮤직비디오 장소** | **33.jfif** | **33.jfif** | ❌ **500** |

### 2) 검증 결과

- `https://borahae.fan/image/runway/runwayuse/22.jpeg` → **정상 응답**
- `https://borahae.fan/image/runway/runwayuse/33.jfif` → **500 Internal Server Error**

### 3) 오류 발생 흐름

1. 사용자가 "6 뮤직비디오 장소" 선택
2. `generateRunwayComposite()` 호출 시 `backgroundPath = 'image/runway/runwayuse/33.jfif'`
3. `urlOrDataUrlToImageParts()` → `fetch('image/runway/runwayuse/33.jfif')`
4. 운영 서버가 **500** 반환 → fetch 실패 → `runwayParts` null
5. `if (!runwayParts || !runwayParts.data)` → **"런웨이 배경 이미지를 불러올 수 없습니다."** throw

### 4) 로컬 vs 운영 차이

| 구분 | 로컬 (local-server.js) | 운영 (Cloudflare Pages) |
|------|------------------------|--------------------------|
| .jfif MIME | `'.jfif': 'image/jpeg'` 명시 | 기본 MIME 매핑에 .jfif 미포함 가능 |
| 정적 파일 처리 | Node.js 직접 서빙 | ASSETS.fetch + CDN |
| 결과 | 정상 | 500 |

### 5) Cloudflare Pages와 .jfif

- Cloudflare Pages는 특정 확장자에 대해 MIME 타입·처리 이슈가 보고된 바 있음
- `.jfif`(JFIF)는 JPEG 계열이지만, CDN/정적 서빙 기본 설정에 포함되지 않을 수 있음
- 500은 404가 아니라 서버 내부 오류 → MIME/처리 실패 가능성 높음

---

## 해결 방안

### ✅ 권장: 33.jfif → 33.jpeg 변환

- JFIF는 JPEG File Interchange Format으로, 바이너리 구조가 JPEG와 동일
- `33.jfif`를 `33.jpeg`로 복사 후 `list.json`에서 `runwayuse/33.jfif` → `runwayuse/33.jpeg`로 변경
- 다른 배경(1~5)과 동일한 `.jpeg` 포맷 사용 → 운영 환경 호환성 확보

### 대안: _headers로 MIME 지정

- `dist/_headers`에 `/*.jfif` → `Content-Type: image/jpeg` 추가
- 단, 500이 MIME만의 문제인지 불명확하므로, 확장자 통일이 더 안전함

---

## 요약

| 구분 | 내용 |
|------|------|
| **현상** | 6 뮤직비디오 장소 선택 시 "런웨이 배경 이미지를 불러올 수 없습니다." |
| **원인** | `33.jfif` 요청 시 Cloudflare Pages에서 500 반환 |
| **차이점** | 1~5번은 .jpeg, 6번만 .jfif 사용 |
| **해결** | 33.jfif → 33.jpeg 변환 및 list.json 수정 |
