# 이메일 결과 발송 설정 (Edge Function 배포)

"결과를 이메일로 받기"가 동작하려면 Supabase에 **send-result-email** Edge Function을 배포하고, Resend API 키를 설정해야 합니다.

---

## 1. Supabase CLI 설치

- **Windows**: https://github.com/supabase/cli/releases 에서 `supabase_windows_amd64.exe` 다운로드 후 PATH에 추가  
  또는 Chocolatey: `choco install supabase`
- **Mac**: `brew install supabase/tap/supabase`

설치 확인:
```bash
supabase --version
```

---

## 2. 로그인 및 프로젝트 연결

```bash
cd d:\AI\borahae1\borahae-fan
supabase login
```

브라우저에서 로그인한 뒤, **같은 Supabase 프로젝트**를 연결합니다.  
(config.js / .env 의 `SUPABASE_URL` 에 있는 프로젝트. 예: `https://ydzqwveyovdfqgehkpui.supabase.co` → 프로젝트 ref는 `ydzqwveyovdfqgehkpui`)

```bash
supabase link --project-ref ydzqwveyovdfqgehkpui
```

프로젝트 ref가 다르면 .env의 SUPABASE_URL에서 호스트명을 확인하세요.

---

## 3. Edge Function 배포

```bash
supabase functions deploy send-result-email
```

성공하면 `Deployed Function send-result-email` 같은 메시지가 나옵니다.

---

## 4. Resend API 키 설정

1. **Resend** 가입 및 API 키 발급: https://resend.com/api-keys  
2. **Supabase 대시보드**: https://supabase.com/dashboard → 해당 프로젝트 선택  
3. **Edge Functions** → **send-result-email** → **Secrets** (또는 Settings → Edge Function Secrets)  
4. **RESEND_API_KEY** 추가, 값에 Resend API 키 입력 (예: `re_xxxx...`)  
5. (선택) **RESEND_FROM_EMAIL** 추가: `보라해 <noreply@yourdomain.com>`  
   - 미설정 시 기본값 `onboarding@resend.dev` 사용 (테스트용)

---

## 5. 동작 확인

1. 사이트에서 로그인  
2. 한글 페르소나 등 결과가 나오는 서비스 사용  
3. **결과를 이메일로 받기** 클릭  
4. 등록된 이메일 받은편지함 확인  

---

## 문제 해결

| 증상 | 확인 사항 |
|------|------------|
| "Edge Function이 배포되지 않았을 수 있어요" | 위 2~3단계 다시 진행. `supabase functions list`로 배포 여부 확인 |
| "이메일 발송이 설정되지 않았습니다" | Supabase에서 **RESEND_API_KEY** 시크릿 설정 여부 확인 |
| 401 로그인 필요 | 로그인한 뒤 다시 시도 |
| 수신 안 됨 | 스팸함, Resend 대시보드에서 발송 로그 확인 |
